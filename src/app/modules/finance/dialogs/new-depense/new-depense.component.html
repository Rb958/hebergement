<h3 mat-dialog-title *ngIf="!isEdition">{{ 'new_depense' | translate }}</h3>
<h3 mat-dialog-title *ngIf="isEdition">{{ 'update_depense' | translate }}</h3>
<form [formGroup]="depenseForm" (ngSubmit)="saveDepense()">
  <div mat-dialog-content>
    <div class="form-content">
      <div class="form-item">
        <label for="type">{{'type' | translate}}<span class="required">*</span></label>
        <div class="input-control" [class.error]="depenseForm.get('type')?.touched && depenseForm.get('type')?.hasError('required')" >
          <select id="type" formControlName="type" #typeLocal name="type" #type>
            <option value="">Selectionner un type</option>
            <option value="Opérationnelles">Opérationnelles</option>
            <option value="Non opérationnelles">Non opérationnelles</option>
          </select>
        </div>
        <span class="hint"></span>
        <span class="hint error" *ngIf="depenseForm.get('type')?.touched && depenseForm.get('type')?.hasError('required')">{{'required_field' | translate}}</span>
      </div>
      <ng-container *ngIf="typeLocal.value == 'Opérationnelles'">
        <div class="form-item" formGroupName="local">
          <label for="local">{{'local' | translate}}<span class="required">*</span></label>
          <div class="input-control" [class.error]="depenseForm.get('local')?.touched && depenseForm.get('local')?.hasError('required')" >
            <select name="local" id="local" formControlName="id">
              <option value="">Selectionner un local</option>
              <option [value]="local.id" *ngFor="let local of locals">{{local.nomLocal}} {{local.numeroLocal}}</option>
            </select>
          </div>
          <span class="hint"></span>
          <span class="hint error" *ngIf="depenseForm.get('local')?.touched && depenseForm.get('local')?.hasError('required')">{{'required_field' | translate}}</span>
        </div>
      </ng-container>
      <div class="form-item">
        <label for="demandeur">{{'demandeur' | translate}}<span class="required">*</span></label>
        <div class="input-control" [class.error]="depenseForm.get('demandeur')?.touched && depenseForm.get('demandeur')?.hasError('required')" >
          <!-- <input type="text" id="demandeur" formControlName="demandeur" name="demandeur" > -->
          <span>{{ localData.userDetails?.firstname }} {{ localData.userDetails?.lastname }}</span>
          <span class="input-error-image" *ngIf="depenseForm.get('demandeur')?.touched && depenseForm.get('demandeur')?.hasError('required')">
            <i class="fa fa-ban" aria-hidden="true"></i>
          </span>
        </div>
        <span class="hint"></span>
        <span class="hint error" *ngIf="depenseForm.get('demandeur')?.touched && depenseForm.get('demandeur')?.hasError('required')">{{'required_field' | translate}}</span>
      </div>
      <div class="form-item">
        <label for="categorie">{{'categorie' | translate}}<span class="required">*</span></label>
        <div class="input-control" [class.error]="depenseForm.get('categorie')?.touched && depenseForm.get('categorie')?.hasError('required')" >
          <select id="categorie" formControlName="categorie" name="categorie">
            <option value="">Selectionner une categorie</option>
            <ng-container *ngIf="type.value == 'Opérationnelles'">
              <option value="Plomberie">Plomberie</option>
              <option value="Menuiserie">Menuiserie</option>
              <option value="Electricité">Electricité</option>
            </ng-container>
            <ng-container *ngIf="type.value != 'Opérationnelles'">
              <option value="Frais de mission">Frais de mission</option>
              <option value="Carburation">Carburation</option>
              <option value="Réparation">Réparation</option>
            </ng-container>
          </select>
        </div>
        <span class="hint"></span>
        <span class="hint error" *ngIf="depenseForm.get('categorie')?.touched && depenseForm.get('categorie')?.hasError('required')">{{'required_field' | translate}}</span>
      </div>
      <ng-container *ngIf="type.value == 'Opérationnelles'">
        <div class="form-item">
          <div class="question-item" >
            <div class="question-check">
              <input type="checkbox" id="isEnterprise" [(ngModel)]="isEnterprise" [ngModelOptions]="{standalone: true}">
              <label for="isEnterprise" class="check-label"></label>
            </div>
            <span class="response_label">Le fournisseur est une entreprise</span>
          </div>
        </div>
        <div class="form-item">
          <label for="fournisseur">{{'fournisseur' | translate}}<span class="required">*</span></label>
          <ng-container *ngIf="isEnterprise">
            <div class="input-control" formGroupName="fournisseurEntreprise">
              <select class="input-control" formControlName="id" id="fournisseurEntreprise">
                <option value="">Selectionner un fournisseur</option>
                <option [value]="four?.id" *ngFor="let four of fournisseursEntreprise">{{four?.raisonSociale}}</option>
              </select>
            </div>
            <span class="hint"></span>
            <span class="hint error" *ngIf="depenseForm.get('fournisseurEntreprise')?.get('id')?.touched && depenseForm.get('fournisseurEntreprise')?.get('id')?.hasError('required')">{{'required_field' | translate}}</span>
          </ng-container>
          <ng-container *ngIf="!isEnterprise">
            <div class="input-control" formGroupName="fournisseurParticulier">
              <select class="input-control" formControlName="id" id="fournisseurParticulier">
                <option value="">Selectionner un fournisseur</option>
                <option [value]="four?.id" *ngFor="let four of fournisseursParticuliers">{{ four?.nom }} {{four?.prenom}}</option>
              </select>
            </div>
            <span class="hint"></span>
            <span class="hint error" *ngIf="depenseForm.get('fournisseurParticulier')?.get('id')?.touched && depenseForm.get('fournisseurParticulier')?.get('id')?.hasError('required')">{{'required_field' | translate}}</span>
          </ng-container>
        </div>
      </ng-container>
      <div class="form-item">
        <label for="montant">{{'montant' | translate}}<span class="required">*</span></label>
        <div class="input-control" [class.error]="depenseForm.get('montant')?.touched && depenseForm.get('montant')?.hasError('required')" >
          <input type="text" id="montant" formControlName="montant" name="montant" >
          <span class="input-error-image" *ngIf="depenseForm.get('montant')?.touched && depenseForm.get('montant')?.hasError('required')">
            <i class="fa fa-ban" aria-hidden="true"></i>
          </span>
        </div>
        <span class="hint"></span>
        <span class="hint error" *ngIf="depenseForm.get('montant')?.touched && depenseForm.get('montant')?.hasError('required')">{{'required_field' | translate}}</span>
      </div>
      <div class="form-item">
        <label for="commentaire">{{'commentaire' | translate}}</label>
        <!-- <div class="input-control" [class.error]="depenseForm.get('commentaire')?.touched && depenseForm.get('commentaire')?.hasError('required')" > -->
          <textarea id="commentaire" formControlName="commentaire" name="commentaire" > </textarea>
          <span class="input-error-image" *ngIf="depenseForm.get('commentaire')?.touched && depenseForm.get('commentaire')?.hasError('required')">
            <i class="fa fa-ban" aria-hidden="true"></i>
          </span>
        <!-- </div> -->
        <span class="hint"></span>
        <span class="hint error" *ngIf="depenseForm.get('commentaire')?.touched && depenseForm.get('commentaire')?.hasError('required')">{{'required_field' | translate}}</span>
      </div>
      <div class="form-item">
        <label for="pjCni">{{'pieceJointe' | translate}}<span class="required">*</span></label>
        <rb-file-uploader (onError)="handleError($event)" (onFinish)="processFinished($event)"></rb-file-uploader>
        <!-- <span class="hint"></span>
        <span class="hint error" *ngIf="locatairePartForm.get('pjCni')?.touched && locatairePartForm.get('pjCni')?.hasError('required')">{{'required_field' | translate}}</span> -->
      </div>
    </div>
  </div>
  <div mat-dialog-actions class="dialog-actions">
    <button class="btn btn-default" [mat-dialog-close]="false" type="button">{{ 'cancel' | translate }}</button>
    <button class="btn btn-primary" rbButton [loading]="loading" [disabled]="depenseForm.invalid" type="submit">{{ 'save' | translate }}</button>
  </div>
</form>
